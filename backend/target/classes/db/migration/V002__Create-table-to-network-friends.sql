-- V2: SOCIAL NETWORK MODULE
-- Stores connection requests between users

CREATE TABLE friendship (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    
    requester_id BIGINT NOT NULL REFERENCES app_user(id), -- Quem pediu
    receiver_id BIGINT NOT NULL REFERENCES app_user(id),  -- Quem recebeu
    
    status VARCHAR(20) NOT NULL, -- 'PENDING', 'ACCEPTED', 'REJECTED'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- Constraints:
    -- 1. Unique pair: Franco cannot request Maria twice (regardless of direction)
    -- This is tricky in SQL, usually handled in code, but we can enforce simple unique:
    UNIQUE (requester_id, receiver_id)
);

-- Add index for performance (finding my friends quickly)
CREATE INDEX idx_friendship_users ON friendship(requester_id, receiver_id);